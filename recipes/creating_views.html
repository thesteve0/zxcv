
<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Creating Views ‚Äî FiftyOne 1.3.0 documentation</title>
<link href="../_static/favicon.ico" rel="shortcut icon"/>
<link href="../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
<link href="../_static/css/voxel51-website.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="image_deduplication.html" rel="next" title="Image Deduplication with FiftyOne"/>
<link href="index.html" rel="prev" title="FiftyOne Recipes"/>
<meta content="https://voxel51.com/wp-content/uploads/2024/03/3.24_webpages_Home_AV.png" property="og:image">
<link href="https://fonts.googleapis.com/css?family=Palanquin:400,600,700,800" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet"/>
<script src="https://tag.clearbitscripts.com/v1/pk_b9ed71c8234edd4f77326bcbfab5a4ca/tags.js"></script>
<script src="../_static/js/modernizr.min.js"></script>
</meta></head>

<body class="pytorch-body">
<div class="table-of-contents-link-wrapper">
<span>Table of Contents</span>
<a class="toggle-table-of-contents" data-behavior="toggle-table-of-contents" href="#"></a>
</div>
<nav class="pytorch-left-menu" data-toggle="wy-nav-shift" id="pytorch-left-menu">
<div class="pytorch-side-scroll">
<div aria-label="main navigation" class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation">
<div class="pytorch-left-menu-search">
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search Docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../teams/index.html">FiftyOne Teams üöÄ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments/index.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheat_sheets/index.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset_zoo/index.html">Dataset Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo/index.html">Model Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../brain.html">FiftyOne Brain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations/index.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/fiftyone.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deprecation.html">Deprecation Notices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>
</div>
</div>
</nav>
<div class="pytorch-container">
<div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
<div class="pytorch-breadcrumbs-wrapper">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="pytorch-breadcrumbs">
<li>
<a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>
<li><a href="index.html">FiftyOne Recipes</a> &gt;</li>
<li>Creating Views</li>
<li class="pytorch-breadcrumbs-aside">
</li>
</ul>
</div>
</div>
<div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Contents
        </div>
</div>
<section class="pytorch-content-wrap" data-toggle="wy-nav-shift" id="pytorch-content-wrap">
<div class="pytorch-content-left">
<div class="rst-content style-external-links">
<div class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<article class="pytorch-article" id="pytorch-article" itemprop="articleBody">
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Creating-Views">
<h1>Creating Views<a class="headerlink" href="#Creating-Views" title="Permalink to this headline">¬∂</a></h1>
<p><a class="reference external" href="https://voxel51.com/docs/fiftyone/user_guide/using_datasets.html">FiftyOne datasets</a> provide the flexibility to store large, complex data. While it is helpful that data can be imported and exported easily, the real potential of FiftyOne comes from its powerful query language that you can use to define custom <strong>views</strong> into your datasets.</p>
<p>A <a class="reference external" href="https://voxel51.com/docs/fiftyone/user_guide/using_views.html">dataset view</a> can be thought of as a pipeline of operations that is applied to a dataset to extract a subset of the dataset whose samples and fields are filtered, sorted, shuffled, etc. Check out <a class="reference external" href="https://voxel51.com/docs/fiftyone/user_guide/using_views.html">this page</a> for an extended discussion of dataset views.</p>
<p>In this notebook, we‚Äôll do a brief walkthrough of creating and using dataset views.</p>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¬∂</a></h2>
<p>If you haven‚Äôt already, install FiftyOne:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>fiftyone
</pre></div>
</div>
</div>
</div>
<div class="section" id="Overview">
<h2>Overview<a class="headerlink" href="#Overview" title="Permalink to this headline">¬∂</a></h2>
<p>To start out, lets import FiftyOne, load up a dataset, and evaluate some predicted object detections.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiftyone</span> <span class="k">as</span> <span class="nn">fo</span>
<span class="kn">import</span> <span class="nn">fiftyone.zoo</span> <span class="k">as</span> <span class="nn">foz</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">foz</span><span class="o">.</span><span class="n">load_zoo_dataset</span><span class="p">(</span><span class="s2">"quickstart"</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">"predictions"</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">"ground_truth"</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">"eval"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Dataset views can range from as simple as ‚Äúselect a slice of the dataset‚Äù to ‚Äúfilter sample that have at least two large bounding boxes of people or dogs with high confidence and that were evaluated to be a false positive, then crop all images to those bounding boxes‚Äù:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fiftyone</span> <span class="kn">import</span> <span class="n">ViewField</span> <span class="k">as</span> <span class="n">F</span>

<span class="c1"># Slice dataset</span>
<span class="n">simple_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">51</span><span class="p">:</span><span class="mi">151</span><span class="p">]</span>

<span class="c1"># Complex filtering and conversion</span>
<span class="n">complex_view</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dataset</span>
    <span class="o">.</span><span class="n">filter_labels</span><span class="p">(</span>
        <span class="s2">"predictions"</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"confidence"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">((</span><span class="n">F</span><span class="p">(</span><span class="s2">"bounding_box"</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s2">"bounding_box"</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"eval"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"fp"</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"label"</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="s2">"person"</span><span class="p">,</span> <span class="s2">"dog"</span><span class="p">]))</span>
        <span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
        <span class="n">F</span><span class="p">(</span><span class="s2">"predictions.detections"</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_patches</span><span class="p">(</span><span class="s2">"predictions"</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The goal is that, by the end of this notebook, creating complex views like the one above will be as straight forward as the simple views.</p>
</div>
<div class="section" id="View-basics">
<h2>View basics<a class="headerlink" href="#View-basics" title="Permalink to this headline">¬∂</a></h2>
<p>‚ÄúCreating a view from a dataset‚Äù is simply the process of performing an operation on a dataset that returns a <code class="docutils literal notranslate"><span class="pre">DatasetView</span></code>. The most basic way to turn a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> into a <code class="docutils literal notranslate"><span class="pre">DatasetView</span></code> is to just call <code class="docutils literal notranslate"><span class="pre">view()</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A view that contains the entire dataset</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Within FiftyOne, views and datasets are largely interchangable in nearly all operations. Anything you can do to a dataset, you can also do to a view.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset:     quickstart
Media type:  image
Num samples: 200
Tags:        ['validation']
Sample fields:
    id:              fiftyone.core.fields.ObjectIdField
    filepath:        fiftyone.core.fields.StringField
    tags:            fiftyone.core.fields.ListField(fiftyone.core.fields.StringField)
    metadata:        fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.metadata.Metadata)
    ground_truth:    fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Detections)
    uniqueness:      fiftyone.core.fields.FloatField
    predictions:     fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Detections)
    eval_tp:         fiftyone.core.fields.IntField
    eval_fp:         fiftyone.core.fields.IntField
    eval_fn:         fiftyone.core.fields.IntField
    is_cloudy:       fiftyone.core.fields.BooleanField
    classification:  fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Classification)
    classifications: fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Classification)
View stages:
    ---
</pre></div></div>
</div>
<p>To create some more interesting views, you need to apply a view stage operation to the dataset. The list of available view stages can be printed as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">list_view_stages</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['exclude',
 'exclude_by',
 'exclude_fields',
 'exclude_frames',
 'exclude_labels',
 'exists',
 'filter_field',
 'filter_labels',
 'filter_classifications',
 'filter_detections',
 'filter_polylines',
 'filter_keypoints',
 'geo_near',
 'geo_within',
 'group_by',
 'limit',
 'limit_labels',
 'map_labels',
 'set_field',
 'match',
 'match_frames',
 'match_labels',
 'match_tags',
 'mongo',
 'select',
 'select_by',
 'select_fields',
 'select_frames',
 'select_labels',
 'shuffle',
 'skip',
 'sort_by',
 'sort_by_similarity',
 'take',
 'to_patches',
 'to_evaluation_patches',
 'to_clips',
 'to_frames']
</pre></div></div>
</div>
<p>These view stages allow you to perform many useful operations on datasets like slicing, sorting, shuffling, filtering, and more.</p>
<p>For example, the <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.take">take()</a> stage lets you extract a random subset of samples from the dataset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_view</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
100
</pre></div></div>
</div>
<p>These view stages can also be chained together, each operating on the view returned by the previous stage:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sorted_random_view</span> <span class="o">=</span> <span class="n">random_view</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="s2">"filepath"</span><span class="p">)</span>
<span class="n">sliced_sorted_random_view</span> <span class="o">=</span> <span class="n">sorted_random_view</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Note that the slicing syntax is simply a different representation of the <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.skip">skip()</a> and <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.limit">limit()</a> stages:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sliced_sorted_random_view</span> <span class="o">=</span> <span class="n">sorted_random_view</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">41</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>An example of one of the stages used in this notebook is <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.match">match()</a>. This stage will keep or remove samples in the dataset one by one based on if some expression applied to the sample resolves to True or False.</p>
<p>For example, we can create a view that includes all samples with a uniqueness greater than 0.5:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matched_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"uniqueness"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Another useful view stage is <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.set_field">set_field()</a>. This stage will actually modify a field in your dataset based on the provided expression. Note that this modification is only within the resulting <code class="docutils literal notranslate"><span class="pre">DatasetView</span></code> and will not modify the underlying dataset.</p>
<p>For example, lets set a boolean field called <code class="docutils literal notranslate"><span class="pre">is_cloudy</span></code> to True for all samples in the dataset. Note that when using <code class="docutils literal notranslate"><span class="pre">set_field()</span></code>, you need to ensure that the field exists on the dataset first.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">add_sample_field</span><span class="p">(</span><span class="s2">"is_cloudy"</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">)</span>
<span class="n">cloudy_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">"is_cloudy"</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="s2">"is_cloudy"</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="View-expressions">
<h2>View expressions<a class="headerlink" href="#View-expressions" title="Permalink to this headline">¬∂</a></h2>
<p>At this point, you might be wondering ‚Äúwhat is this <code class="docutils literal notranslate"><span class="pre">F</span></code> that I keep seeing everywhere‚Äù? That <code class="docutils literal notranslate"><span class="pre">F</span></code> defines a <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewField">ViewField</a> which can be used to write a <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression">ViewExpression</a>. These expressions are what give you the power to write custom queries based on information that exists in
your dataset.</p>
<p>In this section, we go over what some view expression operations and how to write more complex views.</p>
<p>Most view stages accept a <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression">ViewExpression</a> as input. View stages that seemingly operate on fields can also accept expressions! For example, <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.sort_by">sort_by()</a> can accept a field name or an expression:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort by filepaths</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="s2">"filepath"</span><span class="p">)</span>

<span class="c1"># Sort by the number of predicted objects per sample</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"predictions.detections"</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset:     quickstart
Media type:  image
Num samples: 200
Tags:        ['validation']
Sample fields:
    id:           fiftyone.core.fields.ObjectIdField
    filepath:     fiftyone.core.fields.StringField
    tags:         fiftyone.core.fields.ListField(fiftyone.core.fields.StringField)
    metadata:     fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.metadata.Metadata)
    ground_truth: fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Detections)
    uniqueness:   fiftyone.core.fields.FloatField
    predictions:  fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Detections)
    eval_tp:      fiftyone.core.fields.IntField
    eval_fp:      fiftyone.core.fields.IntField
    eval_fn:      fiftyone.core.fields.IntField
    is_cloudy:    fiftyone.core.fields.BooleanField
View stages:
    1. SortBy(field_or_expr={'$size': {'$ifNull': [...]}}, reverse=False)
</pre></div></div>
</div>
<p>The idea is to think about what is expected by a view stage, then provide the input that is needed in the form of a string or an expression.</p>
<p><a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.sort_by">sort_by()</a> operates on a sample-level, meaning we can either provide it the name of a sample-level field to use for sorting (<code class="docutils literal notranslate"><span class="pre">filepath</span></code>) or we can provide it an expression that <em>resolves to</em> a sample-level value. In this case the expression is counting the number of predicted objects for each sample and using those integers to sort the dataset.</p>
<div class="section" id="View-fields">
<h3>View fields<a class="headerlink" href="#View-fields" title="Permalink to this headline">¬∂</a></h3>
<p>As mentioned, view expressions are built around view fields. A <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewField">ViewField</a> is how you inject the information stored in a specific field of your dataset into a view expression.</p>
<p>For example, if you had a boolean field on your dataset called <code class="docutils literal notranslate"><span class="pre">is_cloudy</span></code> indicating if the image contains cloudy or not, then for each sample, <code class="docutils literal notranslate"><span class="pre">F("is_cloudy")</span></code> can be thought of as being replaced with the value of <code class="docutils literal notranslate"><span class="pre">"is_cloudy"</span></code> for that sample. Since values in the field are themselves boolean, the view to match samples where <code class="docutils literal notranslate"><span class="pre">"is_cloudy"</span></code> is True is simply:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cloudy_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"is_cloudy"</span><span class="p">))</span>
</pre></div>
</div>
<p>In our dataset, after performing evaluation, we populated the field <code class="docutils literal notranslate"><span class="pre">eval_tp</span></code> on each sample with is an integer containing the number of true positive predictions exist in the sample. There are multiple ways to match samples based on the <code class="docutils literal notranslate"><span class="pre">eval_tp</span></code> field.</p>
<p>The way to think about view expressions in this case is the same as the expressions for the if-statement in Python that resolve in a boolean context.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">51</span>

<span class="k">if</span> <span class="n">a</span><span class="p">:</span> <span class="c1"># Nothing else needed</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
    <span class="c1"># True if b &gt; 4</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">b</span><span class="p">:</span>
    <span class="c1"># True if b != 0</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tp_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"eval_tp"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tp_view</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
69
</pre></div></div>
</div>
<p>When providing just an integer in the expression in a Python if-statement, then the statement is True as long as the integer is not zero. The same logic applies with view expressions in this case:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nonzero_tp_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"eval_tp"</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nonzero_tp_view</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
198
</pre></div></div>
</div>
<p>We can also use <code class="docutils literal notranslate"><span class="pre">~</span></code> to negate an expression:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zero_tp_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="o">~</span><span class="n">F</span><span class="p">(</span><span class="s2">"eval_tp"</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">zero_tp_view</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">"eval_tp"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 0]
</pre></div></div>
</div>
</div>
<div class="section" id="Nested-lists">
<h3>Nested lists<a class="headerlink" href="#Nested-lists" title="Permalink to this headline">¬∂</a></h3>
<p>The most difficult/subtle aspect of creating view expressions is how to handle nested lists.</p>
<p>To get a better idea of which samples contain lists, you can print out your sample as a dictionary:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span>
    <span class="n">filepath</span><span class="o">=</span><span class="s2">"example.png"</span><span class="p">,</span>
    <span class="n">ground_truth</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">Detections</span><span class="p">(</span>
        <span class="n">detections</span><span class="o">=</span><span class="p">[</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">Detection</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">"cat"</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
        <span class="p">]</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">fo</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
    'filepath': '/content/example.png',
    'tags': [],
    'metadata': None,
    'ground_truth': {
        '_cls': 'Detections',
        'detections': [
            {
                '_id': {'$oid': '622f67345627ae9fa020e6f9'},
                '_cls': 'Detection',
                'attributes': {},
                'tags': [],
                'label': 'cat',
                'bounding_box': [0.1, 0.1, 0.8, 0.8],
            },
        ],
    },
}
</pre></div></div>
</div>
<p>Here you can see that <code class="docutils literal notranslate"><span class="pre">ground_truth.detections</span></code> is a list.</p>
<p>If you have a field containing a primitive value, then it rarely requires more than one operation to get the value that is needed by the view stage. However, when working with a list of values in a field, then there can be multiple different operations that need to be performed to get to the desired value.</p>
<p>The most important operations for working with lists are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression.filter">filter()</a>: apply a boolean to each element of a list to determine what to keep, resolving to a list</p></li>
<li><p><a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression.map">map()</a>: apply a function to each element of a list, resolving to a list</p></li>
<li><p><a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression.reduce">reduce()</a>: operates on a list and resolves to a single value</p></li>
</ul>
</div>
<div class="section" id="Filtering-list-fields">
<h3>Filtering list fields<a class="headerlink" href="#Filtering-list-fields" title="Permalink to this headline">¬∂</a></h3>
<p>The <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression.filter">filter()</a> operation is quite useful to allow for fine-grained access to the information that is to be kept and removed from the view.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only include predictions with `confidence` of at least 0.9</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span>
    <span class="s2">"predictions.detections"</span><span class="p">,</span>
    <span class="n">F</span><span class="p">(</span><span class="s2">"detections"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"confidence"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that the <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.filter_labels">filter_labels()</a> operation is simply a simplification of the filter operation and <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.set_field">set_field()</a>. This operation will automatically apply the given expression to the corresponding list field of the label if applicable (<code class="docutils literal notranslate"><span class="pre">Detections</span></code>, <code class="docutils literal notranslate"><span class="pre">Classifications</span></code>, etc) or
will apply the expression as a match operation for non-list labels (<code class="docutils literal notranslate"><span class="pre">Detection</span></code>, <code class="docutils literal notranslate"><span class="pre">Classification</span></code>, etc).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter detections</span>
<span class="n">view1</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter_labels</span><span class="p">(</span><span class="s2">"ground_truth"</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s2">"label"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"cat"</span><span class="p">)</span>

<span class="c1"># Equivalently</span>
<span class="n">view2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dataset</span>
    <span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">"ground_truth.detections"</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s2">"detections"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"label"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"cat"</span><span class="p">))</span>
    <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"ground_truth.detections"</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">view1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">view2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14
14
</pre></div></div>
</div>
<p>The match operation above was added since by default, <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.dataset.html#fiftyone.core.dataset.Dataset.filter_labels">filter_labels()</a> sets the keyword argument <code class="docutils literal notranslate"><span class="pre">only_matches=True</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add example classification labels</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="s2">"classifications"</span><span class="p">,</span> <span class="p">[</span><span class="n">fo</span><span class="o">.</span><span class="n">Classification</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">"cat"</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>

<span class="c1"># Filter classification</span>
<span class="n">view1</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter_labels</span><span class="p">(</span><span class="s2">"classifications"</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s2">"label"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"cat"</span><span class="p">)</span>

<span class="c1"># Equivalently</span>
<span class="n">view2</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"classifications.label"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"cat"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">view1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">view2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
200
200
</pre></div></div>
</div>
</div>
<div class="section" id="Mapping-list-fields">
<h3>Mapping list fields<a class="headerlink" href="#Mapping-list-fields" title="Permalink to this headline">¬∂</a></h3>
<p>The <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression.map">map()</a> operation can be used to apply an expression to every element of a list. For example, we can update the tags to set every tag to uppercase:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transform_tag</span> <span class="o">=</span> <span class="n">F</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">"tags"</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s2">"tags"</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform_tag</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset:     quickstart
Media type:  image
Num samples: 200
Tags:        ['VALIDATION']
Sample fields:
    id:              fiftyone.core.fields.ObjectIdField
    filepath:        fiftyone.core.fields.StringField
    tags:            fiftyone.core.fields.ListField(fiftyone.core.fields.StringField)
    metadata:        fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.metadata.Metadata)
    ground_truth:    fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Detections)
    uniqueness:      fiftyone.core.fields.FloatField
    predictions:     fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Detections)
    eval_tp:         fiftyone.core.fields.IntField
    eval_fp:         fiftyone.core.fields.IntField
    eval_fn:         fiftyone.core.fields.IntField
    is_cloudy:       fiftyone.core.fields.BooleanField
    classification:  fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Classification)
    classifications: fiftyone.core.fields.EmbeddedDocumentField(fiftyone.core.labels.Classification)
View stages:
    1. SetField(field='tags', expr={'$map': {'as': 'this', 'in': {...}, 'input': '$tags'}})
</pre></div></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">F()</span></code> above is empty, indicating that <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression.upper">upper()</a> is applied to the primitives stored in each element of the field. In this case, the primitives are the string tags. In general, <code class="docutils literal notranslate"><span class="pre">F()</span></code> references the root of the current context.</p>
</div>
<div class="section" id="Reducing-list-fields">
<h3>Reducing list fields<a class="headerlink" href="#Reducing-list-fields" title="Permalink to this headline">¬∂</a></h3>
<p>The <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewField.reduce">reduce()</a> operation lets you take a list, operate on each element of it, and return some value. Reduce expressions generally involve some <code class="docutils literal notranslate"><span class="pre">VALUE</span></code> that is being aggregated as each element is iterated over. For example, this could be some float that values are added to, a string that gets concatenated each iteration, or even a list to which elements are appended.</p>
<p>Say that we want to set a field on our predictions containing the IDs of the corresponding ground truth objects that were matched to the true positives. We can use filter and reduce to accomplish this as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fiftyone.core.expressions</span> <span class="kn">import</span> <span class="n">VALUE</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all of the matched gt object ids</span>
<span class="n">view</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dataset</span>
    <span class="o">.</span><span class="n">set_field</span><span class="p">(</span>
        <span class="s2">"predictions.gt_ids"</span><span class="p">,</span>
        <span class="n">F</span><span class="p">(</span><span class="s2">"detections"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"eval"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"tp"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">VALUE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"eval_id"</span><span class="p">)),</span> <span class="n">init_val</span><span class="o">=</span><span class="p">[])</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">gt_ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['5f452471ef00e6374aac53c8', '5f452471ef00e6374aac53ca']
</pre></div></div>
</div>
</div>
<div class="section" id="Referencing-root-fields">
<h3>Referencing root fields<a class="headerlink" href="#Referencing-root-fields" title="Permalink to this headline">¬∂</a></h3>
<p>Another useful property of expressions is prepending your field names with <code class="docutils literal notranslate"><span class="pre">$</span></code> to refer to the root of the document. This can be used, for example, to use sample-level information like <code class="docutils literal notranslate"><span class="pre">metadata</span></code> when filtering at a detection-level:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">compute_metadata</span><span class="p">()</span>

<span class="c1"># Computes the area of each bounding box in pixels</span>
<span class="n">bbox_area</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">F</span><span class="p">(</span><span class="s2">"$metadata.width"</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s2">"bounding_box"</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span>
    <span class="n">F</span><span class="p">(</span><span class="s2">"$metadata.height"</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s2">"bounding_box"</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Only contains boxes whose area is between 32^2 and 96^2 pixels</span>
<span class="n">medium_boxes_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter_labels</span><span class="p">(</span>
    <span class="s2">"predictions"</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">bbox_area</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bbox_area</span> <span class="o">&lt;</span> <span class="mi">96</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>For a complete listing of all operations that can be performed to create view expressions and examples of each, <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html">check out the API documentation</a>.</p>
</div>
</div>
<div class="section" id="Aggregations">
<h2>Aggregations<a class="headerlink" href="#Aggregations" title="Permalink to this headline">¬∂</a></h2>
<p><a class="reference external" href="https://voxel51.com/docs/fiftyone/user_guide/using_aggregations.html">Aggregations</a> provide a convenient syntax to compute aggregate statistics or extract values across a dataset or view.</p>
<p>For example, you can use aggregations to get information like:</p>
<ul class="simple">
<li><p>The boundary values of a field</p></li>
<li><p>The unique label names in your dataset</p></li>
<li><p>The standard deviation of a value across your samples</p></li>
<li><p>Extract a slice of field values across a view</p></li>
</ul>
<p>You can view the available aggregations like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">list_aggregations</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['bounds',
 'count',
 'count_values',
 'distinct',
 'histogram_values',
 'mean',
 'std',
 'sum',
 'values']
</pre></div></div>
</div>
<p><a class="reference external" href="https://voxel51.com/docs/fiftyone/user_guide/using_aggregations.html">The documentation</a> already contains plenty of detailed information about aggregations. This section just highlights how view expressions can be used with aggregations.</p>
<p>In the simplest case, aggregations can be performed by providing the name of a field you want to compute on:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s2">"predictions.detections.label"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['airplane', 'apple', 'backpack', 'banana', 'baseball glove', 'bear', 'bed', 'bench', 'bicycle', 'bird', 'boat', 'book', 'bottle', 'bowl', 'broccoli', 'bus', 'cake', 'car', 'carrot', 'cat', 'cell phone', 'chair', 'clock', 'couch', 'cow', 'cup', 'dining table', 'dog', 'donut', 'elephant', 'fire hydrant', 'fork', 'frisbee', 'giraffe', 'hair drier', 'handbag', 'horse', 'hot dog', 'keyboard', 'kite', 'knife', 'laptop', 'microwave', 'motorcycle', 'mouse', 'orange', 'oven', 'parking meter', 'person', 'pizza', 'potted plant', 'refrigerator', 'remote', 'sandwich', 'scissors', 'sheep', 'sink', 'skateboard', 'skis', 'snowboard', 'spoon', 'sports ball', 'stop sign', 'suitcase', 'surfboard', 'teddy bear', 'tennis racket', 'tie', 'toaster', 'toilet', 'toothbrush', 'traffic light', 'train', 'truck', 'tv', 'umbrella', 'vase', 'wine glass', 'zebra']
</pre></div></div>
</div>
<p>However, you can also pass a <a class="reference external" href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.expressions.html#fiftyone.core.expressions.ViewExpression">ViewExpression</a> to the aggregation method, in which case the expression will be evaluated and then aggregated as requested:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">"uniqueness"</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.34, 0.53, 0.54, 0.55, 0.56, 0.57, 0.58, 0.59, 0.6, 0.61, 0.62, 0.63, 0.64, 0.65, 0.66, 0.67, 0.68, 0.69, 0.7, 0.72, 0.73, 0.74, 0.75, 0.78, 0.8, 0.82, 0.92, 1.0]
</pre></div></div>
</div>
</div>
<div class="section" id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¬∂</a></h2>
<p>Dataset views and the view expressions language are powerful and flexible aspects of FiftyOne.</p>
<p>Getting comfortable with using views and expressions to slice and dice your datasets based on the questions you have will allow you to work efficiently to curate high quality datasets.</p>
</div>
</div>
</article>
</div>

</div>
</div>
<div class="pytorch-content-right" id="pytorch-content-right">
<div class="pytorch-right-menu" id="pytorch-right-menu">
<div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
<ul>
<li><a class="reference internal" href="#">Creating Views</a><ul>
<li><a class="reference internal" href="#Setup">Setup</a></li>
<li><a class="reference internal" href="#Overview">Overview</a></li>
<li><a class="reference internal" href="#View-basics">View basics</a></li>
<li><a class="reference internal" href="#View-expressions">View expressions</a><ul>
<li><a class="reference internal" href="#View-fields">View fields</a></li>
<li><a class="reference internal" href="#Nested-lists">Nested lists</a></li>
<li><a class="reference internal" href="#Filtering-list-fields">Filtering list fields</a></li>
<li><a class="reference internal" href="#Mapping-list-fields">Mapping list fields</a></li>
<li><a class="reference internal" href="#Reducing-list-fields">Reducing list fields</a></li>
<li><a class="reference internal" href="#Referencing-root-fields">Referencing root fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Aggregations">Aggregations</a></li>
<li><a class="reference internal" href="#Summary">Summary</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</section>
</div>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/doctools.js"></script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
<script src="../_static/js/voxel51-website.js"></script>
<script src="../_static/js/custom.js"></script>
<script src="../_static/js/vendor/popper.min.js" type="text/javascript"></script>
<script src="../_static/js/vendor/bootstrap.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script src="../_static/js/theme.js" type="text/javascript"></script>
<script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Begin Footer -->


<!-- End Footer -->
<!-- Begin Mobile Menu -->

<!-- End Mobile Menu -->
<script src="../_static/js/vendor/anchor.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>