
<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Migrations — FiftyOne 1.3.0 documentation</title>
<link href="../_static/favicon.ico" rel="shortcut icon"/>
<link href="../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
<link href="../_static/css/voxel51-website.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="pluggable_auth.html" rel="next" title="Pluggable Authentication"/>
<link href="management_sdk.html" rel="prev" title="Teams Management SDK"/>
<meta content="https://voxel51.com/wp-content/uploads/2024/03/3.24_webpages_Home_AV.png" property="og:image">
<link href="https://fonts.googleapis.com/css?family=Palanquin:400,600,700,800" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet"/>
<script src="https://tag.clearbitscripts.com/v1/pk_b9ed71c8234edd4f77326bcbfab5a4ca/tags.js"></script>
<script src="../_static/js/modernizr.min.js"></script>
</meta></head>

<body class="pytorch-body">
<div class="table-of-contents-link-wrapper">
<span>Table of Contents</span>
<a class="toggle-table-of-contents" data-behavior="toggle-table-of-contents" href="#"></a>
</div>
<nav class="pytorch-left-menu" data-toggle="wy-nav-shift" id="pytorch-left-menu">
<div class="pytorch-side-scroll">
<div aria-label="main navigation" class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation">
<div class="pytorch-left-menu-search">
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search Docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">FiftyOne Teams 🚀</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environments/index.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipes/index.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheat_sheets/index.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset_zoo/index.html">Dataset Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo/index.html">Model Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../brain.html">FiftyOne Brain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations/index.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/fiftyone.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deprecation.html">Deprecation Notices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>
</div>
</div>
</nav>
<div class="pytorch-container">
<div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
<div class="pytorch-breadcrumbs-wrapper">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="pytorch-breadcrumbs">
<li>
<a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>
<li><a href="index.html">FiftyOne Teams</a> &gt;</li>
<li>Migrations</li>
<li class="pytorch-breadcrumbs-aside">
</li>
</ul>
</div>
</div>
<div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Contents
        </div>
</div>
<section class="pytorch-content-wrap" data-toggle="wy-nav-shift" id="pytorch-content-wrap">
<div class="pytorch-content-left">
<div class="rst-content style-external-links">
<div class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<article class="pytorch-article" id="pytorch-article" itemprop="articleBody">
<div class="section" id="migrations">
<span id="teams-migrations"></span><h1>Migrations<a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h1>
<p>This page describes how to migrate between FiftyOne Teams versions, both for
<a class="reference internal" href="#teams-upgrading"><span class="std std-ref">admins</span></a> migrating the core Teams App infrastructure and
<a class="reference internal" href="#teams-upgrade-python-sdk"><span class="std std-ref">individual users</span></a> who need to install a new
version of the Teams Python SDK.</p>
<p>Refer to <a class="reference internal" href="#teams-migrating-datasets"><span class="std std-ref">this section</span></a> to see how to migrate
existing datasets from open source to Teams.</p>
<div class="section" id="upgrading-your-python-sdk">
<span id="teams-upgrade-python-sdk"></span><h2>Upgrading your Python SDK<a class="headerlink" href="#upgrading-your-python-sdk" title="Permalink to this headline">¶</a></h2>
<p>Users can upgrade their FiftyOne Teams Python client to the latest version as
follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>--index-url<span class="w"> </span>https://<span class="si">${</span><span class="nv">TOKEN</span><span class="si">}</span>@pypi.fiftyone.ai<span class="w"> </span>–-upgrade<span class="w"> </span>fiftyone
</pre></div>
</div>
<p>A specific FiftyOne Teams client version can be installed like so:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>--index-url<span class="w"> </span>https://<span class="si">${</span><span class="nv">TOKEN</span><span class="si">}</span>@pypi.fiftyone.ai<span class="w"> </span><span class="nv">fiftyone</span><span class="o">==</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can find your <code class="code docutils literal notranslate"><span class="pre">TOKEN</span></code> by logging into the FiftyOne Teams App and
clicking on the <a class="reference internal" href="installation.html#teams-python-sdk"><span class="std std-ref">account icon</span></a> in the upper right.</p>
</div>
</div>
<div class="section" id="upgrading-your-deployment">
<span id="teams-upgrading"></span><h2>Upgrading your deployment<a class="headerlink" href="#upgrading-your-deployment" title="Permalink to this headline">¶</a></h2>
<p>The basic <strong>admin workflow</strong> for upgrading a FiftyOne Teams deployment is:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#teams-upgrade-python-sdk"><span class="std std-ref">Upgrade</span></a> all automated services and
individual user workflows that use the Teams Python SDK to an appropriate
SDK version</p></li>
<li><p>Upgrade your core Teams App infrastructure (via Kubernetes, Docker, etc)</p></li>
<li><p>Upgrade your database’s version, as described below</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Contact your Voxel51 CS Engineer for all relevant upgrade information,
including compatible SDK versions, deployment assets, and upgrade
assistance.</p>
</div>
<p>New FiftyOne Teams versions occasionally introduce data model changes that
require database migrations when upgrading your deployment.</p>
<p>Admins can check a deployment’s current version via the Python SDK as shown
below:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>fiftyone<span class="w"> </span>migrate<span class="w"> </span>--info
FiftyOne<span class="w"> </span>Teams<span class="w"> </span>version:<span class="w"> </span><span class="m">0</span>.7.1
FiftyOne<span class="w"> </span>compatibility<span class="w"> </span>version:<span class="w"> </span><span class="m">0</span>.15.1
Database<span class="w"> </span>version:<span class="w"> </span><span class="m">0</span>.15.1

...
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Individual datasets have versions as well. They are lazily upgraded the
first time they are loaded under a new database version. Often there is no
migration required, but there could be.</p>
</div>
<p><a class="reference external" href="https://voxel51.com/docs/fiftyone/user_guide/config.html#database-migrations">Unlike open source FiftyOne</a>,
a Teams database is not automatically upgraded when a user connects to the
database with a newer Python client version. Instead, an admin must manually
upgrade your Teams database by installing the newest version of the Teams SDK
locally, assuming admin privileges, and running the command shown below:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">FIFTYONE_DATABASE_ADMIN</span><span class="o">=</span><span class="nb">true</span>

<span class="c1"># Option 1: update the database version only (datasets lazily migrated on load)</span>
fiftyone<span class="w"> </span>migrate

<span class="c1"># Option 2: migrate the database and all datasets</span>
fiftyone<span class="w"> </span>migrate<span class="w"> </span>--all
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once the database is upgraded, all users must upgrade their Python SDK to a
compatible version. Any connections from incompatible Python clients will
be refused and an informative error message will be displayed.</p>
</div>
</div>
<div class="section" id="downgrading-your-deployment">
<span id="teams-downgrading"></span><h2>Downgrading your deployment<a class="headerlink" href="#downgrading-your-deployment" title="Permalink to this headline">¶</a></h2>
<p>Admins can also downgrade their FiftyOne Teams deployment to an older version
if necessary.</p>
<p>The steps are the same as <a class="reference internal" href="#teams-upgrading"><span class="std std-ref">when upgrading</span></a>, except that
you’ll need to know the appropriate database version to migrate down to. Each
version of Teams corresponds to a version of open source FiftyOne called its
“open source compatibility version”, and this versioning system is used to set
the database version.</p>
<p>For example, you can downgrade to Teams v0.10 like so:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">OS_COMPAT_VERSION</span><span class="o">=</span><span class="m">0</span>.18.0<span class="w">  </span><span class="c1"># OS compatibility version for Teams v0.10.0</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">FIFTYONE_DATABASE_ADMIN</span><span class="o">=</span><span class="nb">true</span>
fiftyone<span class="w"> </span>migrate<span class="w"> </span>--all<span class="w"> </span>-v<span class="w"> </span><span class="si">${</span><span class="nv">OS_COMPAT_VERSION</span><span class="si">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above command must be run with the <strong>newer SDK version</strong> installed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Contact your Voxel51 CS engineer if you need to know the open source
compatibility version for a particular Teams version that you wish to
downgrade to.</p>
</div>
</div>
<div class="section" id="migrating-datasets-to-teams">
<span id="teams-migrating-datasets"></span><h2>Migrating datasets to Teams<a class="headerlink" href="#migrating-datasets-to-teams" title="Permalink to this headline">¶</a></h2>
<p>Any datasets that you have created via open source FiftyOne can be migrated to
your Teams deployment by exporting them in
<a class="reference internal" href="../user_guide/export_datasets.html#fiftyonedataset-export"><span class="std std-ref">FiftyOneDataset</span></a> format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open source SDK</span>
<span class="kn">import</span> <span class="nn">fiftyone</span> <span class="k">as</span> <span class="nn">fo</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">export_dir</span><span class="o">=</span><span class="s2">"/tmp/dataset"</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">FiftyOneDataset</span><span class="p">,</span>
    <span class="n">export_media</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>and then re-importing them with the Teams SDK connected to your Teams
deployment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Teams SDK</span>
<span class="kn">import</span> <span class="nn">fiftyone</span> <span class="k">as</span> <span class="nn">fo</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span>
    <span class="n">dataset_dir</span><span class="o">=</span><span class="s2">"/tmp/dataset"</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">FiftyOneDataset</span><span class="p">,</span>
    <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that you’ll need to update any local filepaths to cloud paths in order to
use the dataset in Teams.</p>
<p>If you need to upload the local media to the cloud, the Teams SDK provides a
builtin utility for this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiftyone.core.storage</span> <span class="k">as</span> <span class="nn">fos</span>

<span class="n">fos</span><span class="o">.</span><span class="n">upload_media</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="s2">"s3://path/for/media"</span><span class="p">,</span>
    <span class="n">update_filepaths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the above method only uploads the media in the <code class="docutils literal notranslate"><span class="pre">filepath</span></code>
field of your samples. If your dataset contains other media fields (e.g.
<a class="reference internal" href="../user_guide/using_datasets.html#dataset-app-config-media-fields"><span class="std std-ref">thumbnails</span></a>,
<a class="reference internal" href="../user_guide/using_datasets.html#semantic-segmentation"><span class="std std-ref">segmentations</span></a>, or
<a class="reference internal" href="../user_guide/using_datasets.html#heatmaps"><span class="std std-ref">heatmaps</span></a>) simply run the above command multiple times,
using the <code class="docutils literal notranslate"><span class="pre">media_field</span></code> argument to specify the appropriate fields to
upload.</p>
<p>If any media fields use the same filenames as other fields, be sure to
provide different <code class="docutils literal notranslate"><span class="pre">remote_dir</span></code> paths each time you call the above method
to avoid overwriting existing media.</p>
</div>
<p>If the files already exist in cloud buckets, you can manually update the
filepaths on the dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cloud_paths</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">"filepath"</span><span class="p">):</span>
    <span class="n">cloud_path</span> <span class="o">=</span> <span class="n">get_cloud_path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>  <span class="c1"># your function</span>
    <span class="n">cloud_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud_path</span><span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="s2">"filepath"</span><span class="p">,</span> <span class="n">cloud_paths</span><span class="p">)</span>
</pre></div>
</div>
<p>When you’re finished, delete the local export of the dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">"/tmp/dataset"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</article>
</div>

</div>
</div>
<div class="pytorch-content-right" id="pytorch-content-right">
<div class="pytorch-right-menu" id="pytorch-right-menu">
<div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
<ul>
<li><a class="reference internal" href="#">Migrations</a><ul>
<li><a class="reference internal" href="#upgrading-your-python-sdk">Upgrading your Python SDK</a></li>
<li><a class="reference internal" href="#upgrading-your-deployment">Upgrading your deployment</a></li>
<li><a class="reference internal" href="#downgrading-your-deployment">Downgrading your deployment</a></li>
<li><a class="reference internal" href="#migrating-datasets-to-teams">Migrating datasets to Teams</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</section>
</div>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/doctools.js"></script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
<script src="../_static/js/voxel51-website.js"></script>
<script src="../_static/js/custom.js"></script>
<script src="../_static/js/vendor/popper.min.js" type="text/javascript"></script>
<script src="../_static/js/vendor/bootstrap.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script src="../_static/js/theme.js" type="text/javascript"></script>
<script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Begin Footer -->


<!-- End Footer -->
<!-- Begin Mobile Menu -->

<!-- End Mobile Menu -->
<script src="../_static/js/vendor/anchor.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>